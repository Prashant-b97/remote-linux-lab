# Segfault Lab Session — 18 September 2025

## Session Goals

- Verify the updated `collect-system-info.sh` script against a live Segfault host.
- Capture stronger security signals (SSH posture, firewall state, Fail2ban) in each report.
- Produce a reusable SSHD baseline so configuration drift is obvious over time.

## Key Commands & Actions

```bash
./scripts/collect-system-info.sh releasecoffee
```

- Ran the reporting helper multiple times while improving error handling (`printf --`, sanitised `awk`, silenced permission errors) to ensure it does not break in restricted containers.
- Saved generated Markdown under `notes/reports/` for future comparison.

```bash
SSHD_BASELINE=examples/sshd_config.baseline ./scripts/collect-system-info.sh releasecoffee
```

- Validated the new baseline feature which appends an **SSHD Config Drift** section when differences from the saved copy are detected.

```bash
ssh releasecoffee 'sshd -T' | sort > /tmp/sshd-effective.conf
ssh releasecoffee 'cat /etc/ssh/sshd_config' > /tmp/sshd-raw.conf
```

- Exported the live SSH daemon settings, trimmed host-specific data, and stored a clean reference at `examples/sshd_config.baseline` for future drift checks.

## Results & Observations

- Each report now includes a **Security Posture** section listing:
  - SSH authentication flags (`PermitRootLogin`, `PasswordAuthentication`).
  - Non-loopback listeners via `ss -tulpn`.
  - Firewall status (`ufw`, `firewall-cmd`, `nft`, or `iptables`) with graceful fallback if root privileges are required.
  - Fail2ban status when the client is installed.
- The script handles Segfault's busybox-style environment gracefully—missing binaries or root-only commands simply log a friendly message instead of aborting the run.
- Baseline diffs shine a light on authentication changes so I can quickly spot regressions such as `PasswordAuthentication yes`.

## Takeaways

- Automation scripts should be hardened to survive partial toolchains (missing `last`, non-systemd hosts, permission issues). The adjustments today make the report reliable across Segfault nodes.
- Storing a sanitized SSH baseline alongside the repo documents my desired security stance, making audits repeatable and beginner friendly.
- Future sessions can build on this by aligning the remote SSH configuration with the desired baseline, introducing log-rotation automation, or wiring the report script into a cron/timer job.

